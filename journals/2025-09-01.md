---
tags:
  - "#ðŸ“…"
---
## Hvordan ser dagen ud? (aftaler)


## Hvad vil jeg gerne opnÃ¥ i dag ?


## Hvordan gik dagen?

### Hetzner - Opret Cloud Server
* [ChatGPT - Cheapest cloud hosting research](https://chatgpt.com/share/68b56401-3574-8007-8bbe-14e112e8b55f)
	* [Development Instances \| Scaleway](https://www.scaleway.com/en/stardust-instances/)
	* [Cheap hosted VPS by Hetzner: our cloud hosting services](https://www.hetzner.com/cloud/)
* Chose Hetzner
Arm64 Amphere servere:

| Server Name | vCPUs | RAM      | SSD       | Traffic   | Price/hour | Price/month |
| ----------- | ----- | -------- | --------- | --------- | ---------- | ----------- |
| **CAX11**   | **2** | **4 GB** | **40 GB** | **20 TB** | **â‚¬0.005** | **â‚¬3.29**   |
| CAX21       | 4     | 8 GB     | 80 GB     | 20 TB     | â‚¬0.010     | â‚¬5.99       |
| CAX31       | 8     | 16 GB    | 160 GB    | 20 TB     | â‚¬0.019     | â‚¬11.99      |
| CAX41       | 16    | 32 GB    | 320 GB    | 20 TB     | â‚¬0.038     | â‚¬23.99      |
* Name: ubuntu-4gb-nbg1-1
	* CAX11 , Neremberg, Ubuntu

### Hetzner SSH til Ny cloud server
* Add text file `2508_AITolk_Hetzner` to `C:\Users\Bruger\.ssh` 
	* paste private key to it
* root@157.90.164.59
* In `C:\Users\Bruger\.ssh\config` add:
```
Host 157.90.164.59
Â  HostName 157.90.164.59
Â  User root
Â  IdentityFile C:\Users\Bruger\.ssh\2508_AITolk_Hetzner
```

```powershell
  ssh -i "C:\Users\Bruger\.ssh\2508_AITolk_Hetzner" root@157.90.164.59
```
* Hvis VSCode driller men powershell ikke har problemer, Ã¦ndre fÃ¸lgende i vscode settings
* "remote.SSH.path": "C:/Program Files/OpenSSH/ssh.exe"
###  Hetzner Pull and run 2508_AITolk docker
* SSH connect to server with vscode root@157.90.164.59
#### Install podman and podman compose  (root)
```shell
# Ubuntu 20.10 and newer  
sudo apt update
sudo apt-get update  
sudo apt-get -y install podman
sudo apt install podman-compose
```

```
sudo apt install qemu-system
```

```shell
# install gvproxy for architecture aarch64
# if in doubt about what architecture the server is run `uname -m`
sudo wget -O /usr/libexec/podman/gvproxy https://github.com/containers/gvisor-tap-vsock/releases/download/v0.8.7/gvproxy-linux-arm64
sudo chmod +x /usr/libexec/podman/gvproxy
```
#### Create non-root user (root)
```shell
# create user
adduser ahmad
# switch to user
su - ahmad
# Add ahmad to the sudo group: 
usermod -aG sudo ahmad
```
password in BitWarden under 2508_AITolk user
After installing, you need to create and start your first Podman machine:
#### Start podman (normal-user)
```
# `su - ahmad` to switch to user ahmad if root 
podman machine init
```
#### Clone repo (normal-user)
* create to srv, apps, data and logs folders
```
# `su - ahmad` to switch to user ahmad if root 
mkdir -p /srv/apps
mkdir -p /srv/data
mkdir -p /srv/logs
```
* pull repo to apps
```
cd /srv/apps
git clone https://github.com/Fjeldmann/2508_AITolk
```
#### Run container 
```
cd /srv/apps/2508_AITolk
sudo podman compose up -d --build
```
### Map Translate.Fjeldmann.dk til Hetzner cloud tolk app server (157.90.164.59) 
#### 1. Point DNS to Hetzner
* [DNS Kontrolpanel - Simply.com](https://www.simply.com/dk/controlpanel/fjeldmann.dk/dns/)
	* Add a **DNS A record**:
	```
	Host: translate 
	Type: A 
	Value: 157.90.164.59 
	TTL: 3600 (or default)
	```   
 This means `translate.fjeldmann.dk â†’ Hetzner server IP`. 
#### 2. Install Caddy on your Hetzner server (root)
```
apt update && apt install -y debian-keyring debian-archive-keyring apt-transport-https 
curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/gpg.key' | gpg --dearmor -o /usr/share/keyrings/caddy-archive-keyring.gpg
mv /usr/share/keyrings/caddy-archive-keyring.gpg /usr/share/keyrings/caddy-stable-archive-keyring.gpg
curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/debian.deb.txt' | tee /etc/apt/sources.list.d/caddy-stable.list 
apt update && apt install caddy -y
```
Caddy runs automatically as a system service.

#### 3. Configure Caddy

Edit the config file: `nano /etc/caddy/Caddyfile` or open in SSH Vscode

Add this block:
```
translate.fjeldmann.dk {
    reverse_proxy 127.0.0.1:8501
}
```

translate.fjeldmann.dk` â†’ domain you pointed in DNS   
reverse_proxy` â†’ tells Caddy to forward traffic to your container
 * Save and exit, then reload:
`systemctl reload caddy`

### Map `auth.fjeldmann.dk` til  auth service pÃ¥ Hetzner cloud  server (157.90.164.59) 
#### 1. Point DNS to Hetzner
* [DNS Kontrolpanel - Simply.com](https://www.simply.com/dk/controlpanel/fjeldmann.dk/dns/)
	* Add a **DNS A record**:
	```
	Host: auth 
	Type: A 
	Value: 157.90.164.59 
	TTL: 3600 (or default)
	```   
 This means `translate.fjeldmann.dk â†’ Hetzner server IP`. 
#### 2. (Skip) Install Caddy on your Hetzner server (root)

#### 3. Configure Caddy

Edit the config file: `nano /etc/caddy/Caddyfile` or open in SSH Vscode

Add this block:
```
translate.fjeldmann.dk {
    reverse_proxy 127.0.0.1:8501
}
```

translate.fjeldmann.dk` â†’ domain you pointed in DNS   
reverse_proxy` â†’ tells Caddy to forward traffic to your container

 * Save and exit, then reload:
``` 
systemctl reload caddy
```

